<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="QuestionMapper">
	<resultMap type="Question" id="questionResultMap">
		<id property="questionNo" column="QUESTION_NO"/>
		<result property="professorName" column="PROFESSOR_NAME"/>
		<result property="lectureName" column="LECTURE_NAME"/>
		<result property="questionTitle" column="QUESTION_TITLE"/>
		<result property="questionContent" column="QUESTION_CONTENT"/>
		<result property="questionWriter" column="QUESTION_WRITER"/>
		<result property="questionDate" column="QUESTION_DATE"/>
		<result property="questionUpdateDate" column="QUESTION_UPDATEDATE"/>
		<result property="questionCount" column="QUESTION_COUNT"/>
		<result property="questionFileName" column="QUESTION_FILENAME"/>
		<result property="questionFileReNeme" column="QUESTION_FILERENAME"/>
		<result property="questionFilePath" column="QUESTION_FILEPATH"/>
		
	</resultMap>

	<select id="selectAllQuestion" resultMap="questionResultMap">
		SELECT * FROM QUESTION_TBL ORDER BY QUESTION_NO DESC
	</select>
	
	<select id="selectSearchQuestion" resultMap="questionResultMap">
		SELECT * FROM QUESTION_TBL
		<if test="searchCondition.toString() == 'writer'">
			WHERE QUESTION_WRITER LIKE '%' || #{searchValue} || '%'
		</if>
		<if test="searchCondition.toString() == 'title'">
			WHERE QUESTION_TITLE LIKE '%' || #{searchValue} || '%'
		</if>
		<if test="searchCondition.toString() == 'contents'">
			WHERE QUESTION_CONTENT LIKE '%' || #{searchValue} || '%'
		</if>
		<if test="searchCondition.toString() == 'all'">
			WHERE QUESTION_CONTENT LIKE '%' || #{searchValue} || '%'
			OR
			QUESTION_TITLE LIKE '%' || #{searchValue} || '%'
			OR QUESTION_WRITER LIKE
			'%' || #{searchValue} || '%'
		</if>
		<if test="searchCondition.toString() == 'professor'">
			WHERE PROFESSOR_NAME LIKE '%' || #{searchValue} || '%'		
		</if>
		<if test="searchCondition.toString() == 'lecture'">
			WHERE LECTURE_NAME LIKE '%' || #{searchValue} || '%'		
		</if>
		ORDER BY QUESTION_NO DESC
	</select>
	
	<select id="selectOneQuestion" resultMap="questionResultMap">
		SELECT * FROM QUESTION_TBL WHERE QUESTION_NO = #{questionNo}
	</select>

	<insert id="insertQuestion">
		INSERT INTO QUESTION_TBL VALUES(SEQ_QUESTION_NO.NEXTVAL, #{professorName}, #{lectureName}, #{questionTitle}, #{questionContent}, #{questionWriter}, DEFAULT, DEFAULT, DEFAULT, #{questionFileName}, #{questionFileReNeme}, #{questionFilePath})
	</insert>
	
	<update id="updateQuestion">
		UPDATE QUESTION_TBL SET PROFESSOR_NAME = #{professorName}, LECTURE_NAME = #{lectureName}, QUESTION_TITLE = #{questionTitle}, QUESTION_CONTENT = #{questionContent}, QUESTION_UPDATEDATE = DEFAULT, QUESTION_FILENAME = #{questionFileName}, QUESTION_FILERENAME = #{questionFileReNeme}, QUESTION_FILEPATH = #{questionFilePath} WHERE QUESTION_NO = #{questionNo}
	</update>
	
	<update id="updateCount">
		UPDATE QUESTION_TBL SET QUESTION_COUNT = QUESTION_COUNT + 1 WHERE QUESTION_NO = #{questionNo}
	</update>
	
	<delete id="deleteQuestion">
		DELETE FROM QUESTION_TBL WHERE QUESTION_NO = #{questionNo}
	</delete>

</mapper>